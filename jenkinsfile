pipeline {
    agent {
        node {
            label 't059-runner'
        }
    }
    stages {
        stage('checkout') {
            steps {
                git credentialsId: 'ca-git-access', branch: 'sample-html-app', url: 'https://git.cloudavise.com/visops/t059/sample-html-app.git'
            }
        }
        stage('Deploy nginx') {
            steps {
                sh 'ansible-vault decrypt --vault-id /opt/vault_id ec2-1.pem'
                sh "chmod 400 demo.pem"
                sh 'ansible-playbook -i inventory deployment-nginx.yaml'	
            }
        }
    }
}
